# Setup server
sudo snap install microk8s --classic
microk8s enable dns
echo "alias kubectl='microk8s.kubectl'" > ~/.bash_aliases && . ~/.bash_aliases
git clone https://github.com/rogiller/speed-demo.git

# BUILD

# Get a JAR
./gradlew clean build
 
java -jar build/libs/speed-demo-0.0.1-SNAPSHOT.jar

# Docker Jazz
docker build -t flexrentalsolutions/speed-demo:v4 .

docker push flexrentalsolutions/speed-demo:v4

docker run -p 8090:8090 -t flexrentalsolutions/speed-demo

docker pull flexrentalsolutions/speed-demo:latest

# UPDATE DEPLOYMENT
kubectl set image deployments/speed-demo-deployment speed-demo=flexrentalsolutions/speed-demo:v4
kubectl rollout status deployments/speed-demo-deployment


# Clean up old replicasets
kubectl delete $(kubectl get all | grep replicaset.apps | grep "0         0         0" | cut -d' ' -f 1)


http://167.99.57.223:<node-port>


kubectl logs -f speed-demo-****


# Kubetail rocks!
https://github.com/johanhaleby/kubetail


# See usage
kubectl top pod

# Pod logs go to here on the host:
/var/log/pods


kubectl get pods -o wide

# If you want to watch it
kubectl get pods --watch
kubectl get service --watch

# Template for creating a secret
kubectl create secret generic speed-demo-secret --from-literal=SPEED_DEMO_JDBC_URL='<insert>' --from-literal=SPEED_DEMO_JDBC_PASSWORD='<insert>'
